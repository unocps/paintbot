<launch>
    <arg name="scan_topic" default="/laserscan" />

    <node name="twist_marker_server"
        pkg="interactive_marker_twist_server"
        type="marker_server"
        output="screen" />
    <node name="twist_mux" pkg="twist_mux" type="twist_mux">
        <rosparam command="load" file="$(find paintbot_navigation)/config/twist_mux.yaml" />
        <remap from="cmd_vel_out" to="diff_drive/cmd_vel" />
    </node>

    <node name="slam_gmapping" pkg="gmapping" type="slam_gmapping">
        <rosparam>
            map_frame: map
            odom_frame: odom
            base_frame: virtual_base

            map_update_interval: 0.5 # Publish new map

            maxUrange: 9.9 # Should be just less than sensor range
            maxRange: 10.1 # Should be just greater than sensor range
            particles: 100 # Increased from 80

            # Update frequencies
            linearUpdate: 0.3
            angularUpdate: 0.5
            temporalUpdate: 2.0
            resampleThreshold: 0.5

            # Initial Map Size
            xmin: -100.0
            ymin: -100.0
            xmax: 100.0
            ymax: 100.0
            delta: 0.05

            # All default
            sigma: 0.05
            kernelSize: 1
            lstep: 0.05
            astep: 0.05
            iterations: 5
            lsigma: 0.075
            ogain: 3.0
            lskip: 0
            llsamplerange: 0.01
            llsamplestep: 0.01
            lasamplerange: 0.005
            lasamplestep: 0.005
        </rosparam>
        <remap from="scan" to="$(arg scan_topic)" />
    </node>

    <node name="amcl" pkg="amcl" type="amcl">
        <param name="use_map_topic" value="true" />
        <param name="base_frame_id" value="virtual_base" />
        <param name="tf_broadcast" value="false" />
        <remap from="scan" to="$(arg scan_topic)"/>
    </node>

    <node name="move_base" pkg="move_base" type="move_base" respawn="false" output="screen">
        <param name="base_global_planner" value="navfn/NavfnROS" />
        <!-- <param name="base_global_planner" value="global_planner/GlobalPlanner" /> -->
        <!-- <param name="base_local_planner" value="dwa_local_planner/DWAPlannerROS" /> -->
        <!-- <param name="base_local_planner" value="base_local_planner/TrajectoryPlannerROS" /> -->
        <param name="base_local_planner" value="teb_local_planner/TebLocalPlannerROS" />
        <rosparam file="$(find paintbot_navigation)/config/planner.yaml" command="load" />
        <rosparam file="$(find paintbot_navigation)/config/costmap_common.yaml" command="load" ns="global_costmap" />
        <rosparam file="$(find paintbot_navigation)/config/costmap_global.yaml" command="load" ns="global_costmap" />
        <rosparam file="$(find paintbot_navigation)/config/costmap_common.yaml" command="load" ns="local_costmap" />
        <rosparam file="$(find paintbot_navigation)/config/costmap_local.yaml" command="load" ns="local_costmap" />
        <remap from="cmd_vel" to="diff_drive/cmd_vel" />
    </node>
</launch>
